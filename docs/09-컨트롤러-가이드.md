# Quest 3 컨트롤러 가이드

Quest 3 컨트롤러의 버튼 배치와 Unity에서 사용하는 방법을 알아봅시다!

---

## 컨트롤러 버튼 배치

### 왼손 컨트롤러

```
          [Y 버튼]
          [X 버튼]

     ┌─────────────┐
     │ [Thumbstick]│  ← 썸스틱 (조이스틱)
     │      ●      │
     └─────────────┘

        [Trigger]     ← 트리거 (검지 손가락)

        [Grip]        ← 그립 (중지 손가락)

     [Menu 버튼]      ← 메뉴 (왼손에만 있음)
```

### 오른손 컨트롤러

```
          [B 버튼]
          [A 버튼]

     ┌─────────────┐
     │ [Thumbstick]│  ← 썸스틱 (조이스틱)
     │      ●      │
     └─────────────┘

        [Trigger]     ← 트리거 (검지 손가락)

        [Grip]        ← 그립 (중지 손가락)

     [Oculus 버튼]    ← Oculus (오른손에만 있음, 시스템용)
```

---

## Unity에서의 버튼 이름

Quest 3 버튼이 Unity에서는 다른 이름으로 불려요.

### 버튼 매핑 표

| Quest 3 버튼 | Unity 이름 | 설명 |
|--------------|------------|------|
| **X 버튼** (왼손) | Primary Button (Left) | 주 버튼 |
| **Y 버튼** (왼손) | Secondary Button (Left) | 보조 버튼 |
| **A 버튼** (오른손) | Primary Button (Right) | 주 버튼 |
| **B 버튼** (오른손) | Secondary Button (Right) | 보조 버튼 |
| **트리거** | Trigger / Select | 선택, 발사 |
| **그립** | Grip / Grab | 잡기 |
| **썸스틱** | Primary 2D Axis | 이동, 방향 |
| **썸스틱 클릭** | Primary 2D Axis Click | 달리기 등 |
| **메뉴 버튼** | Menu Button | 메뉴 열기 |

---

## 기본 조작법 (XR Interaction Toolkit)

이 프로젝트에서 사용하는 기본 조작이에요.

### 물체 상호작용

| 동작 | 버튼 | 설명 |
|------|------|------|
| **물체 잡기** | 그립 버튼 | 그립을 쥐면 물체를 잡아요 |
| **물체 던지기** | 그립 버튼 놓기 | 움직이면서 놓으면 던져져요 |
| **물체 사용** | 트리거 | 잡은 상태에서 트리거로 사용 |

### 이동

| 동작 | 버튼 | 설명 |
|------|------|------|
| **텔레포트** | 오른손 썸스틱 위 | 가리키고 놓으면 순간이동 |
| **연속 이동** | 왼손 썸스틱 | 일반 게임처럼 이동 |
| **회전** | 오른손 썸스틱 좌우 | 45도씩 회전 |
| **달리기** | 왼손 썸스틱 클릭 + 이동 | 빠르게 이동 |

### 게임 시스템

| 동작 | 버튼 | 설명 |
|------|------|------|
| **손전등 켜기/끄기** | Y 버튼 | 손전등 토글 |
| **메뉴 열기** | 메뉴 버튼 | 일시정지 메뉴 |

---

## 코드에서 입력 받기

### 새 Input System 사용하기

```csharp
using UnityEngine.InputSystem;

public class MyController : MonoBehaviour
{
    public InputActionProperty triggerAction;
    public InputActionProperty gripAction;

    void Update()
    {
        // 트리거 값 읽기 (0~1)
        float triggerValue = triggerAction.action.ReadValue<float>();

        // 그립 값 읽기 (0~1)
        float gripValue = gripAction.action.ReadValue<float>();

        if (triggerValue > 0.5f)
        {
            Debug.Log("트리거 눌림!");
        }
    }
}
```

### XR Interaction Toolkit 이벤트 사용하기

```csharp
using UnityEngine.XR.Interaction.Toolkit;

public class MyInteractable : XRGrabInteractable
{
    protected override void OnActivated(ActivateEventArgs args)
    {
        // 트리거를 눌렀을 때
        Debug.Log("트리거!");
    }

    protected override void OnSelectEntered(SelectEnterEventArgs args)
    {
        // 그립으로 잡았을 때
        Debug.Log("잡음!");
    }

    protected override void OnSelectExited(SelectExitEventArgs args)
    {
        // 그립을 놓았을 때
        Debug.Log("놓음!");
    }
}
```

---

## 컨트롤러 진동 추가하기

### 간단한 방법 (Quest3Controller 사용)

```csharp
using HorrorGame;

public class MyGrabbable : XRGrabInteractable
{
    protected override void OnSelectEntered(SelectEnterEventArgs args)
    {
        base.OnSelectEntered(args);

        // 잡을 때 진동
        var controller = args.interactorObject.transform
            .GetComponent<Quest3Controller>();
        controller?.VibrateClick();
    }
}
```

### 직접 진동 제어하기

```csharp
using UnityEngine.XR;

void VibrateController(XRNode hand, float amplitude, float duration)
{
    InputDevice device = InputDevices.GetDeviceAtXRNode(hand);

    if (device.TryGetHapticCapabilities(out HapticCapabilities capabilities))
    {
        if (capabilities.supportsImpulse)
        {
            device.SendHapticImpulse(0, amplitude, duration);
        }
    }
}

// 사용 예시
VibrateController(XRNode.RightHand, 0.5f, 0.1f);
```

---

## 컨트롤러 위치/회전 가져오기

### 컨트롤러 Transform 접근

```csharp
public class ControllerInfo : MonoBehaviour
{
    public XRController leftController;
    public XRController rightController;

    void Update()
    {
        // 왼손 컨트롤러 위치
        Vector3 leftPos = leftController.transform.position;
        Quaternion leftRot = leftController.transform.rotation;

        // 오른손 컨트롤러 위치
        Vector3 rightPos = rightController.transform.position;
        Quaternion rightRot = rightController.transform.rotation;

        Debug.Log($"오른손 위치: {rightPos}");
    }
}
```

---

## 자주 쓰는 패턴

### 양손으로 무기 잡기

```csharp
public class TwoHandedWeapon : XRGrabInteractable
{
    public Transform secondGrabPoint;  // 두 번째 손이 잡을 위치

    private XRBaseInteractor secondHand;

    // 두 번째 손이 잡았을 때 방향 조절
    void Update()
    {
        if (secondHand != null)
        {
            // 두 손 사이 방향으로 무기 회전
            Vector3 direction = secondHand.transform.position
                              - transform.position;
            transform.rotation = Quaternion.LookRotation(direction);
        }
    }
}
```

### 물체 던지기 강화

```csharp
public class ThrowableObject : XRGrabInteractable
{
    public float throwForceMultiplier = 1.5f;

    protected override void OnSelectExited(SelectExitEventArgs args)
    {
        base.OnSelectExited(args);

        // 던질 때 힘 강화
        Rigidbody rb = GetComponent<Rigidbody>();
        rb.velocity *= throwForceMultiplier;
    }
}
```

---

## 다음 단계

컨트롤러 사용법을 배웠어요! 문제가 생기면 아래 문서를 확인하세요.

[다음: 문제 해결 >](10-문제해결.md)
